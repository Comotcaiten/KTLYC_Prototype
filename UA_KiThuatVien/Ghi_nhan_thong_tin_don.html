<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technician - Quản lý đơn sửa chữa</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .form-container {
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #343a40;
        }

        .form-label {
            font-weight: 600;
        }

        .btn-primary {
            width: 100%;
            font-size: 18px;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="container mt-4">
        <h1>Thông tin đơn sửa chữa</h1>
        <table class="table table-bordered mt-3">
            <thead class="table-dark">
                <tr>
                    <th>Họ và tên</th>
                    <th>Số điện thoại</th>
                    <th>Email</th>
                    <th>Tên thiết bị</th>
                    <th>Chi nhánh</th>
                    <th>Ngày gửi</th>
                    <th>Tiến độ sửa chữa</th>
                    <th>Tổng chi phí (VND)</th>
                    <th>Ghi chú lỗi</th>
                    <th>Xem chi tiết</th>
                    <th>Xóa đơn</th>
                </tr>
            </thead>
            <tbody id="orderTableBody"></tbody>
        </table>
    </div>

    <!-- Modal for Adding Notes -->
    <div class="modal fade" id="noteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ghi chú thêm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <textarea id="noteInput" class="form-control" rows="4" placeholder="Nhập ghi chú lỗi..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" id="saveNoteButton">Lưu ghi chú</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Viewing Details -->
    <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Chi tiết đơn sửa chữa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Họ và tên:</strong> <span id="detailName"></span></p>
                    <p><strong>Số điện thoại:</strong> <span id="detailPhone"></span></p>
                    <p><strong>Email:</strong> <span id="detailEmail"></span></p>
                    <p><strong>Tên thiết bị:</strong> <span id="detailDevice"></span></p>
                    <p><strong>Chi nhánh:</strong> <span id="detailBranch"></span></p>
                    <p><strong>Ngày gửi:</strong> <span id="detailDate"></span></p>
                    <p><strong>Tiến độ sửa chữa:</strong> <span id="detailStatus"></span></p>
                    <p><strong>Tổng chi phí:</strong> <span id="detailCost"></span></p>
                    <p><strong>Ghi chú:</strong> <span id="detailNotes"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Repair Details -->
    <div class="form-container" id="repairDetailsModal" style="display: none;">
        <form id="repairDetailsForm">
            <h1>Ghi Nhận Thông Tin Sửa Chữa Chi Tiết</h1>

            <div class="mb-3">
                <label for="orderId" class="form-label">Mã đơn sửa chữa:</label>
                <input type="text" id="orderId" name="orderId" class="form-control" placeholder="Nhập mã đơn sửa chữa" required>
            </div>

            <div class="mb-3">
                <label for="errorDescription" class="form-label">Mô tả lỗi:</label>
                <textarea id="errorDescription" name="errorDescription" class="form-control" rows="3" placeholder="Nhập mô tả lỗi cụ thể" required></textarea>
            </div>

            <div class="mb-3">
                <label for="repairMethod" class="form-label">Phương pháp sửa chữa:</label>
                <textarea id="repairMethod" name="repairMethod" class="form-control" rows="3" placeholder="Nhập phương pháp sửa chữa" required></textarea>
            </div>

            <div class="mb-3">
                <label for="repairTime" class="form-label">Thời gian sửa chữa:</label>
                <input type="time" id="repairTime" name="repairTime" class="form-control" required>
            </div>

            <div class="mb-3">
                <label for="faultyPartImage" class="form-label">Ảnh chụp linh kiện bị lỗi (nếu cần):</label>
                <input type="file" id="faultyPartImage" name="faultyPartImage" class="form-control" accept="image/*">
            </div>

            <button type="button" onclick="saveRepairDetails()" class="btn btn-primary">Lưu thông tin sửa chữa</button>
        </form>
    </div>

    <script>
        const orders = JSON.parse(localStorage.getItem('orders')) || [];
        const repairStatuses = [
            "Máy đang tới trung tâm bảo dưỡng",
            "Đang sửa máy",
            "Đang trả máy về chi nhánh",
            "Chờ nhận máy",
            "Đã xong"
        ];
        const tableBody = document.getElementById('orderTableBody');

        function renderOrders() {
            tableBody.innerHTML = "";
            orders.forEach((order, index) => {
                const row = `
                    <tr>
                        <td>${order.customerName}</td>
                        <td>${order.phoneNumber}</td>
                        <td>${order.email}</td>
                        <td>${order.deviceName}</td>
                        <td>${order.branch}</td>
                        <td>${order.appointmentDate}</td>
                        <td>
                            <select id="status-${index}" class="form-control">
                                ${repairStatuses.map(status => 
                                    `<option value="${status}" ${status === order.repairStatus ? 'selected' : ''}>${status}</option>`).join('')}
                            </select>
                        </td>
                        <td><input type="number" id="cost-${index}" value="${order.totalCost}" class="form-control"></td>
                        <td><button class="btn btn-info" onclick="showNoteModal(${index})">Ghi chú</button></td>
                        <td><button class="btn btn-primary" onclick="showDetails(${index})">Xem chi tiết</button></td>
                        <td><button class="btn btn-danger" onclick="deleteOrder(${index})">Xóa</button></td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        function deleteOrder(index) {
            if (confirm("Bạn có chắc chắn muốn xóa đơn này?")) {
                orders.splice(index, 1);
                localStorage.setItem('orders', JSON.stringify(orders));
                renderOrders();
            }
        }

        function showNoteModal(index) {
            const noteInput = document.getElementById('noteInput');
            noteInput.value = orders[index].note || '';
            document.getElementById('saveNoteButton').onclick = () => saveNote(index);
            const noteModal = new bootstrap.Modal(document.getElementById('noteModal'));
            noteModal.show();
        }

        function saveNote(index) {
            const noteInput = document.getElementById('noteInput');
            orders[index].note = noteInput.value;
            localStorage.setItem('orders', JSON.stringify(orders));
            renderOrders();
            const noteModal = bootstrap.Modal.getInstance(document.getElementById('noteModal'));
            noteModal.hide();
        }

        function showDetails(index) {
            const order = orders[index];
            document.getElementById('detailName').innerText = order.customerName;
            document.getElementById('detailPhone').innerText = order.phoneNumber;
            document.getElementById('detailEmail').innerText = order.email;
            document.getElementById('detailDevice').innerText = order.deviceName;
            document.getElementById('detailBranch').innerText = order.branch;
            document.getElementById('detailDate').innerText = order.appointmentDate;
            document.getElementById('detailStatus').innerText = order.repairStatus;
            document.getElementById('detailCost').innerText = order.totalCost;
            document.getElementById('detailNotes').innerText = order.note || 'Chưa có ghi chú';
            const detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));
            detailsModal.show();
        }

        function saveRepairDetails() {
            const orderId = document.getElementById('orderId').value;
            const errorDescription = document.getElementById('errorDescription').value;
            const repairMethod = document.getElementById('repairMethod').value;
            const repairTime = document.getElementById('repairTime').value;
            const faultyPartImage = document.getElementById('faultyPartImage').files[0];

            // Handle form submission logic here

            alert("Thông tin sửa chữa đã được lưu.");
        }

        renderOrders();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
